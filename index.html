<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Bear Maze</title>

<style>
  * { margin:0; padding:0; box-sizing:border-box; touch-action: manipulation; }

  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: black;
    font-family: system-ui, sans-serif;
  }

  #game-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
  }

  canvas {
    display: block;
    margin: auto;
  }

  #message, #start-overlay {
    position: fixed;
    top:0; left:0;
    width: 100vw;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: rgba(0,0,0,0.85);
    font-size: 18px;
    line-height: 1.5;
    z-index: 100;
    flex-direction: column;
    color: white;
  }

  #message { display: none; }
  #start-overlay { cursor: pointer; color: hotpink; font-size: 24px; }

  #controls {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: grid;
    grid-template-columns: repeat(3, 60px);
    grid-template-rows: repeat(3, 60px);
    gap: 6px;
    z-index: 50;
  }

  #controls div { width: 60px; height: 60px; }

  button {
    font-size: 20px;
    background: #222;
    color: white;
    border: 1px solid white;
    border-radius: 8px;
  }

  button:active { background: #444; }
</style>
</head>
<body>

<div id="game-wrapper">
  <canvas id="maze"></canvas>

  <div id="message">
    <div>
      <strong>You made it mahal! üíñ</strong><br><br>
      Your wait is over! Let's make this official. ü•∞<br>
      Now, it's my turn to wait.<br><br>
      Behave ka lang d'yan, please.<br><br>
      I love you. üíñ
    </div>
  </div>

  <div id="start-overlay">
    Tap to Start
  </div>
</div>

<div id="controls">
  <div></div>
  <button onclick="move(0,-1)">‚Üë</button>
  <div></div>
  <button onclick="move(-1,0)">‚Üê</button>
  <div></div>
  <button onclick="move(1,0)">‚Üí</button>
  <div></div>
  <button onclick="move(0,1)">‚Üì</button>
  <div></div>
</div>

<script>
const canvas = document.getElementById('maze');
const ctx = canvas.getContext('2d');
const message = document.getElementById('message');
const controls = document.getElementById('controls');
const startOverlay = document.getElementById('start-overlay');

let soundStarted = false;
let completed = false;

// sounds
const heartbeat = new Audio('heartbeat.mp3');
heartbeat.loop = true;
heartbeat.volume = 0.5;

const loveSound = new Audio('love.mp3');
loveSound.loop = true;
loveSound.volume = 0.6;

// resize maze dynamically
function resizeCanvas() {
  const size = Math.min(window.innerWidth, window.innerHeight) * 0.6;
  canvas.width = size;
  canvas.height = size;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const tile = 30;
const maze = [
  '##########',
  '#S     # #',
  '# ### ### #',
  '#   #     #',
  '### ##### #',
  '#     #   #',
  '# ### ### #',
  '#   #   ##',
  '# # # #   ',
  '#########E'
];
let player = { x: 1, y: 1 };

// floating hearts
let hearts = [];
function initHearts() {
  hearts = [];
  const numHearts = Math.floor((window.innerWidth * window.innerHeight) / 5000);
  for (let i = 0; i < numHearts; i++) {
    hearts.push({
      x: Math.random() * window.innerWidth,
      y: Math.random() * window.innerHeight,
      speed: 0.5 + Math.random() * 1.5
    });
  }
}
initHearts();
window.addEventListener('resize', initHearts);

function drawHearts() {
  ctx.font = '16px serif';
  ctx.fillStyle = 'rgba(255,105,180,0.6)';
  for (let h of hearts) {
    ctx.fillText('‚ô•Ô∏è', h.x, h.y);
    h.y -= h.speed;
    if (h.y < -10) {
      h.y = window.innerHeight + 10;
      h.x = Math.random() * window.innerWidth;
    }
  }
}

function drawMaze() {
  const cellSize = canvas.width / maze[0].length;
  for (let y = 0; y < maze.length; y++) {
    for (let x = 0; x < maze[y].length; x++) {
      if (maze[y][x] === '#') {
        ctx.fillStyle = 'white';
        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
      }
      if (maze[y][x] === 'E') {
        ctx.font = `${cellSize}px serif`;
        ctx.fillText('üêª‚Äç‚ùÑÔ∏è', x * cellSize + cellSize*0.1, y * cellSize + cellSize*0.9);
      }
    }
  }
  ctx.font = `${canvas.width/maze[0].length}px serif`;
  ctx.fillText('üêª', player.x * (canvas.width/maze[0].length) + canvas.width/maze[0].length*0.1, player.y * (canvas.width/maze[0].length) + canvas.width/maze[0].length*0.9);
}

function draw() {
  ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
  drawHearts();
  if (!completed) drawMaze();
  requestAnimationFrame(draw);
}
draw();

function move(dx, dy) {
  if (!soundStarted || completed) return;
  const nx = player.x + dx;
  const ny = player.y + dy;
  if (maze[ny] && maze[ny][nx] !== '#') {
    player.x = nx;
    player.y = ny;
    if (maze[ny][nx] === 'E') complete();
  }
}

function complete() {
  completed = true;
  heartbeat.pause(); heartbeat.currentTime = 0;
  loveSound.play().catch(()=>{});
  if (navigator.vibrate) navigator.vibrate([200,100,200]);
  message.style.display = 'flex';
  controls.style.display = 'none';
}

startOverlay.addEventListener('click', () => {
  heartbeat.play().catch(()=>{});
  soundStarted = true;
  startOverlay.style.display = 'none';
});
</script>

</body>
</html>
