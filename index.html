<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Bear Maze</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  touch-action: manipulation;
}

html, body {
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
  font-family: system-ui, sans-serif;
}

#game-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

#game-container {
  position: relative;
  width: min(90vw, 420px);
  aspect-ratio: 9 / 16;
  border: 2px solid white;
}

canvas {
  width: 100%;
  height: 100%;
  display: block;
}

#message, #start-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  flex-direction: column;
  color: white;
  z-index: 10;
}

#message { display: none; }

#start-overlay {
  cursor: pointer;
  font-size: 24px;
  color: hotpink;
}
</style>
</head>
<body>

<div id="game-wrapper">
  <div id="game-container">
    <canvas id="maze"></canvas>

    <div id="message">
      <div>
        <strong>You made it mahal! üíñ</strong><br><br>
        Your wait is over! Let's make this official. ü•∞<br>
        Now, it's my turn to wait.<br><br>
        Behave ka lang d'yan, please.<br><br>
        I love you. üíñ
      </div>
    </div>

    <div id="start-overlay">Tap to Start</div>
  </div>
</div>

<script>
const canvas = document.getElementById('maze');
const ctx = canvas.getContext('2d');
const message = document.getElementById('message');
const startOverlay = document.getElementById('start-overlay');

let soundStarted = false;
let completed = false;

// layout
let width, height;
let mazeHeight, controlHeight;

// sounds
const heartbeat = new Audio('heartbeat.mp3');
heartbeat.loop = true;
heartbeat.volume = 0.5;

const loveSound = new Audio('love.mp3');
loveSound.loop = true;
loveSound.volume = 0.6;

// resize
function resizeCanvas() {
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;

  width = canvas.width;
  height = canvas.height;

  controlHeight = height * 0.28;
  mazeHeight = height - controlHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// maze
const maze = [
  '##########',
  '#S     #  ',
  '# ### ### #',
  '    #     #',
  '### ##### #',
  '#     #   #',
  '# ### ### #',
  '    #   ##',
  '# # # #   ',
  '# #######E'
];

let player = { x: 1, y: 1 };

// hearts (restricted to canvas)
let hearts = [];
function initHearts() {
  hearts = [];
  const count = Math.floor((width * height) / 9000);
  for (let i = 0; i < count; i++) {
    hearts.push({
      x: Math.random() * width,
      y: Math.random() * height,
      speed: 0.4 + Math.random()
    });
  }
}
initHearts();
window.addEventListener('resize', initHearts);

function drawHearts() {
  ctx.font = '16px serif';
  ctx.fillStyle = 'rgba(255,105,180,0.6)';
  hearts.forEach(h => {
    ctx.fillText('‚ô•Ô∏è', h.x, h.y);
    h.y -= h.speed;
    if (h.y < 0) {
      h.y = height;
      h.x = Math.random() * width;
    }
  });
}

// maze drawing (GRID SAFE)
function drawMaze() {
  const rows = maze.length;
  const cols = maze[0].length;
  const cell = Math.min(width / cols, mazeHeight / rows);

  // walls & exit
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const cx = x * cell;
      const cy = y * cell;

      if (maze[y][x] === '#') {
        ctx.fillStyle = 'white';
        ctx.fillRect(cx, cy, cell, cell);
      }

      if (maze[y][x] === 'E') {
        ctx.font = `${cell * 0.9}px serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('üêª‚Äç‚ùÑÔ∏è', cx + cell / 2, cy + cell / 2);
      }
    }
  }

  // player (FIXED: perfectly centered)
  ctx.font = `${cell * 0.9}px serif`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(
    'üêª',
    player.x * cell + cell / 2,
    player.y * cell + cell / 2
  );
}

// controls
function drawControls() {
  const size = 50;
  const gap = 12;
  const centerX = width / 2;
  const centerY = mazeHeight + controlHeight / 2;

  const buttons = [
    { x: centerX, y: centerY - size - gap, dx: 0, dy: -1, label: '‚Üë' },
    { x: centerX - size - gap, y: centerY, dx: -1, dy: 0, label: '‚Üê' },
    { x: centerX + size + gap, y: centerY, dx: 1, dy: 0, label: '‚Üí' },
    { x: centerX, y: centerY + size + gap, dx: 0, dy: 1, label: '‚Üì' }
  ];

  buttons.forEach(b => {
    ctx.strokeStyle = 'white';
    ctx.strokeRect(b.x - size/2, b.y - size/2, size, size);
    ctx.fillStyle = 'white';
    ctx.font = '24px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(b.label, b.x, b.y);
  });

  canvas.onclick = e => {
    const r = canvas.getBoundingClientRect();
    const mx = e.clientX - r.left;
    const my = e.clientY - r.top;
    buttons.forEach(b => {
      if (
        mx > b.x - size/2 && mx < b.x + size/2 &&
        my > b.y - size/2 && my < b.y + size/2
      ) move(b.dx, b.dy);
    });
  };
}

function draw() {
  ctx.clearRect(0, 0, width, height);
  drawHearts();
  if (!completed) {
    drawMaze();
    drawControls();
  }
  requestAnimationFrame(draw);
}
draw();

function move(dx, dy) {
  if (!soundStarted || completed) return;
  const nx = player.x + dx;
  const ny = player.y + dy;
  if (maze[ny] && maze[ny][nx] !== '#') {
    player.x = nx;
    player.y = ny;
    if (maze[ny][nx] === 'E') complete();
  }
}

function complete() {
  completed = true;
  heartbeat.pause();
  loveSound.play().catch(()=>{});
  navigator.vibrate?.([200,100,200]);
  message.style.display = 'flex';
}

startOverlay.onclick = () => {
  heartbeat.play().catch(()=>{});
  soundStarted = true;
  startOverlay.style.display = 'none';
};
</script>

</body>
</html>
